<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>▒BLACK DICE▒</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* 추가된 CSS는 아래에 포함 */
    </style>
</head>
<body>
    <header>
        <div class="logo">   BLACK DICE</div>
        <nav>
            <ul id="nav-menu">
                <li><a href="#" id="home-btn">Início</a></li>
                <li><a href="#" class="btn" id="live-casino-sidebar">Cassino Ao Vivo</a></li>
                <li><a href="#" class="btn" id="slots-sidebar">Slots</a></li>
                <li><a href="#" class="btn" id="sports-sidebar">Esportes</a></li>
                <li><a href="#" class="btn login" id="login-btn">Entrar</a></li>
                <li><a href="#" class="btn signup" id="signup-btn">Cadastrar</a></li>
            </ul>
            <ul id="user-info" style="display: none;">
                <li><span id="user-name"></span>, <span id="user-balance"></span></li>
                <li><a href="#" class="btn" id="depositar-btn">DEPOSITAR</a></li>
                <li><a href="#" class="btn" id="saque-pix-link">SAQUE</a></li>
                <li><a href="#" class="btn" id="live-casino-user">Cassino Ao Vivo</a></li>
                <li><a href="#" class="btn" id="slots-user">Slots</a></li>
                <li><a href="#" class="btn" id="sports-user">Esportes</a></li>
                <li><a href="#" class="btn" id="logout-btn">SAIR</a></li>
            </ul>
        </nav>
    </header>
    <div class="container">
        <aside class="sidebar">
            <ul>
                <li><a href="#">Black Dice</a></li>
                <li><a href="#">Bônus</a></li>
                <li><a href="#">Suporte</a></li>
                <li><a href="#">Suporte Ao Vivo</a></li>
                <li><a href="#">Promoções</a></li>
                <li><a href="#">Indique Um Amigo</a></li>
                <li><a href="#">Patrocínios</a></li>
            </ul>
            <div class="chat-board">
                <div class="online-count" id="online-count">ONLINE: 0 Pessoas</div>
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input-container">
                    <input type="text" id="chat-input" placeholder="메시지를 입력하세요..." maxlength="100">
                    <button id="chat-send" class="btn">전송</button>
                </div>
            </div>
        </aside>
        <main id="main-content">
            <section class="banner" id="banner-section">
                <div class="banner-content">
                    <h1>Promoção Imperdível!</h1>
                    <p>Ganhe até 500% de bônus!</p>
                    <a href="#" class="btn play-now">Jogar Agora</a>
                </div>
            </section>
            <section class="iframe-container" id="iframe-container" style="display: none;">
                <iframe id="game-iframe" width="100%" height="600px" src="" frameborder="0"></iframe>
            </section>
            <section class="games" id="popular-games">
                <h2>Jogos Populares</h2>
                <div class="games-grid"></div>
            </section>
            <section class="live-casino" id="live-casino-games" style="display: none;">
                <h2>Cassino Ao Vivo</h2>
                <div class="games-grid"></div>
            </section>
            <section class="slots" id="slots-games" style="display: none;">
                <h2>Slots</h2>
                <div class="games-grid"></div>
            </section>
            <section class="sports" id="sports-games" style="display: none;">
                <h2>Esportes</h2>
                <div class="games-grid"></div>
            </section>
        </main>
        <main id="form-content" style="display: none;">
            <div class="form-container">
                <form id="login-form">
                    <h2>Entrar</h2>
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" name="loginEmail" required maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Senha:</label>
                        <input type="password" id="loginPassword" name="loginPassword" required maxlength="20">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn login" id="loginButton">Entrar</button>
                        <button type="button" class="btn signup" id="show-signup-form">Cadastrar</button>
                    </div>
                </form>
                <form id="signup-form" method="POST" action="signup.php" style="display: none;">
                    <h2>Cadastrar</h2>
                    <div class="form-group">
                        <label for="signupName">Nome:</label>
                        <input type="text" id="signupName" name="signupName" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPix">PIX:</label>
                        <input type="text" id="signupPix" name="signupPix" required>
                    </div>
                    <div class="form-group">
                        <label for="signupCPF">CPF:</label>
                        <input type="text" id="signupCPF" name="signupCPF" required>
                    </div>
                    <div class="form-group">
                        <label for="signupDOB">Data de Nascimento:</label>
                        <input type="date" id="signupDOB" name="signupDOB" required>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email:</label>
                        <input type="email" id="signupEmail" name="signupEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPhone">Telefone:</label>
                        <input type="tel" id="signupPhone" name="signupPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Senha:</label>
                        <input type="password" id="signupPassword" name="signupPassword" required maxlength="20">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn signup" id="signupButton">Cadastrar</button>
                        <button type="button" class="btn login" id="show-login-form">Entrar</button>
                    </div>
                </form>
            </div>
        </main>
    </div>
    <div id="deposit-modal" class="modal">
        <div class="modal-content">
            <div class="logo">BLACK DICE</div>
            <div class="modal-body">
                <label for="deposit-amount">Digite o valor:</label>
                <input type="number" id="deposit-amount" maxlength="20">
                <button id="btn-60" class="btn">60</button>
                <button id="btn-240" class="btn">240</button>
                <button id="btn-600" class="btn">600</button>
                <button id="btn-digitar" class="btn">Digitar</button>
                <button id="generate-code-btn" class="btn">GERAR CODIGO</button>
            </div>
        </div>
    </div>
    <div id="saque-modal" class="modal">
        <div class="modal-content">
            <div class="logo">BLACK DICE</div>
            <div class="modal-body">
                <h2>Parabéns!</h2>
                <p>Você ganhou!</p>
                <p>Nome: <span id="saque-nome"></span></p>
                <p>CPF: <span id="saque-cpf"></span></p>
                <p>PIX: <span id="saque-pix"></span></p>
                <p>BALANCE: <span id="saque-balance"></span> BRL</p>
                <label for="saque-amount">Digite o valor:</label>
                <input type="number" id="saque-amount" maxlength="20">
                <button id="saque-confirm-btn" class="btn">Saque</button>
                <button id="close-saque-popup" class="btn">Fechar</button>
            </div>
        </div>
    </div>
    <div id="alert" class="alert" style="display: none;">
        <div class="alert-content">
            <p>회원가입이 완료되었습니다!</p>
            <button id="close-alert" class="btn">확인</button>
        </div>
    </div>
    <footer>
        <div class="footer-content">
            <p>Suporte: <a href="mailto:support@blackdice.com">support@blackdice.com</a> | 
            Parceiros: <a href="mailto:partners@blackdice.com">partners@blackdice.com</a> | 
            Jurídico: <a href="mailto:legal@blackdice.com">legal@blackdice.com</a> | 
            Imprensa: <a href="mailto:press@blackdice.com">press@blackdice.com</a></p>
        </div>
        <p>&copy; 2024 Black Dice. Todos os direitos reservados.</p>
        <p>A Prolific Trade N.V. é licenciada e regulamentada pela Antillephone N.V, sob a licença nº 8048/JAZ2024-009</p>
        <p>A Black Dice aceita apenas clientes com mais de 18 anos de idade. Apostar pode ser viciante. Jogue responsavelmente.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, updateDoc, where } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDhRkSDgED4xcWTAHvA_bRMhACNIUA1SLQ",
            authDomain: "blackdice-490e9.firebaseapp.com",
            projectId: "blackdice-490e9",
            storageBucket: "blackdice-490e9.appspot.com",
            messagingSenderId: "468114117476",
            appId: "1:468114117476:web:626cbb82e7b8a5d72b2071",
            measurementId: "G-5NEKZ1MRRP"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth();
        const db = getFirestore(app);

        const mainContent = document.getElementById("main-content");
        const formContent = document.getElementById("form-content");
        const loginForm = document.getElementById("login-form");
        const signupForm = document.getElementById("signup-form");
        const iframeContainer = document.getElementById("iframe-container");
        const gameIframe = document.getElementById("game-iframe");
        const bannerSection = document.getElementById("banner-section");

        const homeBtn = document.getElementById("home-btn");
        const loginBtn = document.getElementById("login-btn");
        const signupBtn = document.getElementById("signup-btn");
        const showSignupFormBtn = document.getElementById("show-signup-form");
        const showLoginFormBtn = document.getElementById("show-login-form");

        const liveCasinoSidebar = document.getElementById("live-casino-sidebar");
        const slotsSidebar = document.getElementById("slots-sidebar");
        const sportsSidebar = document.getElementById("sports-sidebar");

        const liveCasinoUser = document.getElementById("live-casino-user");
        const slotsUser = document.getElementById("slots-user");
        const sportsUser = document.getElementById("sports-user");

        const navMenu = document.getElementById("nav-menu");
        const userInfo = document.getElementById("user-info");
        const userName = document.getElementById("user-name");
        const userBalance = document.getElementById("user-balance");

        const alertBox = document.getElementById("alert");
        const closeAlertBtn = document.getElementById("close-alert");

        closeAlertBtn.addEventListener("click", () => {
            alertBox.style.display = "none";
        });

        homeBtn.addEventListener("click", function() {
            mainContent.style.display = "block";
            formContent.style.display = "none";
            iframeContainer.style.display = "none";
            bannerSection.style.display = "block";
            document.getElementById("popular-games").style.display = "block";
            document.getElementById("live-casino-games").style.display = "none";
            document.getElementById("slots-games").style.display = "none";
            document.getElementById("sports-games").style.display = "none";
            generateGames('popular-games', 12);
        });

        loginBtn.addEventListener("click", function() {
            mainContent.style.display = "none";
            formContent.style.display = "flex";
            iframeContainer.style.display = "none";
            bannerSection.style.display = "none";
            loginForm.style.display = "block";
            signupForm.style.display = "none";
        });

        signupBtn.addEventListener("click", function() {
            mainContent.style.display = "none";
            formContent.style.display = "flex";
            iframeContainer.style.display = "none";
            bannerSection.style.display = "none";
            loginForm.style.display = "none";
            signupForm.style.display = "block";
        });

        showSignupFormBtn.addEventListener("click", function() {
            loginForm.style.display = "none";
            signupForm.style.display = "block";
        });

        showLoginFormBtn.addEventListener("click", function() {
            signupForm.style.display = "none";
            loginForm.style.display = "block";
        });

        document.getElementById('signupButton').addEventListener('click', (event) => {
            event.preventDefault();
            const signupEmail = document.getElementById('signupEmail').value;
            const signupPassword = document.getElementById('signupPassword').value;
            const signupName = document.getElementById('signupName').value;
            const signupPix = document.getElementById('signupPix').value;
            const signupCPF = document.getElementById('signupCPF').value;
            const signupDOB = document.getElementById('signupDOB').value;
            const signupPhone = document.getElementById('signupPhone').value;

            createUserWithEmailAndPassword(auth, signupEmail, signupPassword)
                .then((userCredential) => {
                    const user = userCredential.user;
                    // Save additional user information in the Firestore
                    const userRef = doc(db, "users", user.uid);
                    setDoc(userRef, {
                        name: signupName,
                        pix: signupPix,
                        cpf: signupCPF,
                        dob: signupDOB,
                        phone: signupPhone,
                        balance: 0 // Initialize balance
                    }).then(() => {
                        // Show alert and redirect to login form
                        alertBox.style.display = "block";
                        signupForm.style.display = "none";
                        loginForm.style.display = "block";
                    });
                })
                .catch((error) => {
                    console.error(error.code, error.message);
                });
        });

        document.getElementById('loginButton').addEventListener('click', (event) => {
            event.preventDefault();
            const loginEmail = document.getElementById('loginEmail').value;
            const loginPassword = document.getElementById('loginPassword').value;

            signInWithEmailAndPassword(auth, loginEmail, loginPassword)
                .then((userCredential) => {
                    const user = userCredential.user;
                    updateUserInfo(user);
                    // Redirect to home screen after login
                    homeBtn.click();
                })
                .catch((error) => {
                    console.error(error.code, error.message);
                });
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            signOut(auth).then(() => {
                navMenu.style.display = "flex";
                userInfo.style.display = "none";
            }).catch((error) => {
                console.error(error.code, error.message);
            });
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                updateUserInfo(user);
                updateOnlineCount();
            } else {
                navMenu.style.display = "flex";
                userInfo.style.display = "none";
                onlineCount.innerText = 'ONLINE: 0 Pessoas';
            }
        });

        function updateUserInfo(user) {
            const userRef = doc(db, "users", user.uid);
            getDoc(userRef).then((docSnap) => {
                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    userName.innerText = `${userData.name}`;
                    userBalance.innerText = `Saldo : ${userData.balance.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
                    navMenu.style.display = "none";
                    userInfo.style.display = "flex";
                } else {
                    console.error("No such document!");
                }
            }).catch((error) => {
                console.error(error.code, error.message);
            });
        }

        function showLiveCasino() {
            mainContent.style.display = "block";
            formContent.style.display = "none";
            iframeContainer.style.display = "none";
            bannerSection.style.display = "none";
            document.getElementById("popular-games").style.display = "none";
            document.getElementById("live-casino-games").style.display = "block";
            document.getElementById("slots-games").style.display = "none";
            document.getElementById("sports-games").style.display = "none";
            generateGames('live-casino-games', 20);
        }

        function showSlots() {
            mainContent.style.display = "block";
            formContent.style.display = "none";
            iframeContainer.style.display = "none";
            bannerSection.style.display = "none";
            document.getElementById("popular-games").style.display = "none";
            document.getElementById("live-casino-games").style.display = "none";
            document.getElementById("slots-games").style.display = "block";
            document.getElementById("sports-games").style.display = "none";
            generateGames('slots-games', 20);
        }

        function showSports() {
            mainContent.style.display = "block";
            formContent.style.display = "none";
            iframeContainer.style.display = "none";
            bannerSection.style.display = "none";
            document.getElementById("popular-games").style.display = "none";
            document.getElementById("live-casino-games").style.display = "none";
            document.getElementById("slots-games").style.display = "none";
            document.getElementById("sports-games").style.display = "block";
            generateGames('sports-games', 20);
        }

        function generateGames(sectionId, count) {
            var section = document.getElementById(sectionId);
            var gamesGrid = section.querySelector('.games-grid');
            gamesGrid.innerHTML = '';

            var gameNames = [
                "Blackjack Classic", "Roleta Europeia", "Baccarat", "Poker Texas Hold'em", "Bingo", "Caça-níquel Megaways",
                "Craps", "Pôquer de Três Cartas", "Baccarat Ao Vivo", "Roleta Americana", "Blackjack VIP", "Dream Catcher",
                "Monopoly Live", "Mega Ball", "Sic Bo", "Dragon Tiger", "Jogo do Bicho", "Keno", "Roleta Francesa", "Blackjack Switch",
                "Stud Poker", "Casino Hold'em", "Double Ball Roulette", "Football Studio", "Lightning Dice", "Deal or No Deal",
                "Side Bet City", "Crazy Time", "Mega Wheel", "Cash or Crash", "Gonzo's Treasure Hunt", "Roulette Double Up",
                "Poker Omaha", "Baccarat Squeeze", "Pontoon", "Three Card Poker Prime", "Dragonara Roulette", "Auto Roulette",
                "Speed Baccarat", "No Commission Baccarat", "First Person Blackjack", "Caribbean Stud Poker", "Texas Hold'em Bonus",
                "Free Bet Blackjack", "Infinite Blackjack", "Blackjack Party", "Instant Roulette", "Double Exposure Blackjack",
                "European Poker Tour", "World Series of Poker", "PokerStars Live", "All American Poker", "Ultimate Texas Hold'em",
                "Let It Ride", "Pai Gow Poker", "Five Card Draw", "High Card Flush", "Razz Poker", "Chinese Poker", "Open Face Chinese Poker"
            ];

            for (var i = 0; i < count; i++) {
                var gameItem = document.createElement('div');
                gameItem.className = 'game-item';
                gameItem.innerHTML = `
                    <img src="image${i % 60 + 1}.png" alt="${gameNames[i % gameNames.length]}">
                    <h3>${gameNames[i % gameNames.length]}</h3>
                    <div class="game-buttons">
                        <a href="#" class="btn small play-now">Jogar Agora</a>
                        <a href="#" class="btn small">Demo</a>
                    </div>
                `;
                gamesGrid.appendChild(gameItem);
            }

            var playNowButtons = document.querySelectorAll(".play-now");
            playNowButtons.forEach(function(button) {
                button.addEventListener("click", function() {
                    var videoSrc = this.getAttribute("data-video");
                    bannerSection.style.display = "none";
                    iframeContainer.style.display = "block";
                    gameIframe.src = videoSrc;

                    gameIframe.onload = function() {
                        setTimeout(function() {
                            var iframeDoc = gameIframe.contentDocument || gameIframe.contentWindow.document;
                            var betBoardWrapper = iframeDoc.querySelector(".betboard_desktop_wrapper.dndBetBoard.droppable-cancel.global_bb_shadow");
                            var userBalanceElement = document.getElementById("user-balance");

                            function decreaseBalance() {
                                var balance = parseFloat(userBalanceElement.innerText.replace('Saldo : ', '').replace(' BRL', '').replace(/\./g, '').replace(',', '.'));
                                balance -= 1;
                                userBalanceElement.innerText = 'Saldo : ' + balance.toLocaleString('pt-BR') + ' BRL';
                            }

                            function attachClickListeners() {
                                var paths = betBoardWrapper.querySelectorAll("path");
                                paths.forEach(function(path) {
                                    path.addEventListener("click", decreaseBalance);
                                });
                            }

                            if (betBoardWrapper) {
                                attachClickListeners();
                            } else {
                                var interval = setInterval(function() {
                                    betBoardWrapper = iframeDoc.querySelector(".betboard_desktop_wrapper.dndBetBoard.droppable-cancel.global_bb_shadow");
                                    if (betBoardWrapper) {
                                        attachClickListeners();
                                        clearInterval(interval);
                                    }
                                }, 1000);
                            }
                        }, 3000);
                    };
                });
            });
        }

        generateGames('popular-games', 12);
        generateGames('live-casino-games', 20);
        generateGames('slots-games', 20);
        generateGames('sports-games', 20);

        liveCasinoSidebar.addEventListener("click", function() {
            showLiveCasino();
        });

        slotsSidebar.addEventListener("click", function() {
            showSlots();
        });

        sportsSidebar.addEventListener("click", function() {
            showSports();
        });

        liveCasinoUser.addEventListener("click", function() {
            showLiveCasino();
        });

        slotsUser.addEventListener("click", function() {
            showSlots();
        });

        sportsUser.addEventListener("click", function() {
            showSports();
        });

        // Deposit functionality
        const depositBtn = document.getElementById('depositar-btn');
        const depositModal = document.getElementById('deposit-modal');
        const generateCodeBtn = document.getElementById('generate-code-btn');
        const btn60 = document.getElementById('btn-60');
        const btn240 = document.getElementById('btn-240');
        const btn600 = document.getElementById('btn-600');
        const btnDigitar = document.getElementById('btn-digitar');

        depositBtn.addEventListener('click', () => {
            depositModal.style.display = 'flex';
        });

        generateCodeBtn.addEventListener('click', () => {
            depositModal.classList.add('fade-out');
            setTimeout(() => {
                depositModal.style.display = 'none';
                depositModal.classList.remove('fade-out');
            }, 1000);
        });

        btn60.addEventListener('click', () => {
            openPixWindow('https://geradordepix.com/pagamento/xkGEzKfr');
        });

        btn240.addEventListener('click', () => {
            openPixWindow('https://geradordepix.com/pagamento/vnbMclNE');
        });

        btn600.addEventListener('click', () => {
            openPixWindow('https://geradordepix.com/pagamento/yBETjUdn');
        });

        btnDigitar.addEventListener('click', () => {
            document.getElementById('deposit-amount').focus();
        });

        function openPixWindow(url) {
            const newWindow = window.open(url, 'PIX Window', 'width=600,height=600');
            newWindow.onload = () => {
                newWindow.document.body.style.display = 'flex';
                newWindow.document.body.style.justifyContent = 'center';
                newWindow.document.body.style.alignItems = 'center';
            };
        }

        // Chat functionality
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');
        const onlineCount = document.getElementById('online-count');

        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        chatSend.addEventListener('click', () => {
            sendMessage();
        });

        function sendMessage() {
            if (chatInput.value.trim() === '') return;

            const user = auth.currentUser;
            if (!user) {
                alert('로그인이 필요합니다.');
                return;
            }

            const userDoc = getDoc(doc(db, 'users', user.uid)).then((userDoc) => {
                if (!userDoc.exists()) {
                    alert('유저 정보를 찾을 수 없습니다.');
                    return;
                }

                const message = {
                    text: chatInput.value.trim(),
                    timestamp: serverTimestamp(),
                    username: userDoc.data().name
                };

                addDoc(collection(db, 'chat', 'general', 'messages'), message);
                chatInput.value = '';
            });
        }

        const q = query(collection(db, 'chat', 'general', 'messages'), orderBy('timestamp', 'asc'));

        onSnapshot(q, (snapshot) => {
            chatMessages.innerHTML = '';
            snapshot.forEach((doc) => {
                const msg = doc.data();
                const time = msg.timestamp.toDate();
                const timeString = time.getHours().toString().padStart(2, '0') + ':' + time.getMinutes().toString().padStart(2, '0');
                const msgDiv = document.createElement('div');
                msgDiv.textContent = `${msg.username}: ${msg.text} (${timeString})`;
                chatMessages.appendChild(msgDiv);

                const now = new Date();
                const messageTime = msg.timestamp.toDate();
                const timeDiff = now - messageTime;

                if (timeDiff > 180000) { // 30 minutes
                    deleteDoc(doc.ref);
                }
            });

            chatMessages.scrollTop = chatMessages.scrollHeight;
        });

        // Online user count
        onAuthStateChanged(auth, (user) => {
            if (user) {
                updateUserInfo(user);
                updateOnlineCount();
            } else {
                navMenu.style.display = "flex";
                userInfo.style.display = "none";
                onlineCount.innerText = 'ONLINE: 0 Pessoas';
            }
        });

        function updateOnlineCount() {
            const onlineQuery = query(collection(db, 'users'), where('online', '==', true));
            onSnapshot(onlineQuery, (snapshot) => {
                const onlineUsers = snapshot.size;
                onlineCount.innerText = `ONLINE: ${onlineUsers} Pessoas`;
            });
        }

        // Update user online status
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const userRef = doc(db, 'users', user.uid);
                updateDoc(userRef, { online: true });

                window.addEventListener('beforeunload', () => {
                    updateDoc(userRef, { online: false });
                });
            }
        });

        // Saque PIX Popup
        const saquePixLink = document.getElementById('saque-pix-link');
        const saqueModal = document.getElementById('saque-modal');
        const closeSaquePopupButton = document.getElementById('close-saque-popup');
        const saqueNome = document.getElementById('saque-nome');
        const saqueCpf = document.getElementById('saque-cpf');
        const saquePix = document.getElementById('saque-pix');
        const saqueBalance = document.getElementById('saque-balance');
        const saqueAmount = document.getElementById('saque-amount');
        const saqueConfirmBtn = document.getElementById('saque-confirm-btn');

        saquePixLink.addEventListener('click', function(event) {
            event.preventDefault();
            const user = auth.currentUser;
            if (user) {
                getDoc(doc(db, 'users', user.uid)).then((userDoc) => {
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        saqueNome.innerText = userData.name;
                        saqueCpf.innerText = userData.cpf;
                        saquePix.innerText = userData.pix;
                        saqueBalance.innerText = userData.balance;
                        saqueModal.style.display = 'flex';
                    }
                });
            }
        });

        closeSaquePopupButton.addEventListener('click', function() {
            saqueModal.style.display = 'none';
        });

        saqueConfirmBtn.addEventListener('click', function() {
            const user = auth.currentUser;
            if (user) {
                getDoc(doc(db, 'users', user.uid)).then((userDoc) => {
                    if (userDoc.exists()) {
                        const userData = userDoc.data();
                        const saqueValue = parseFloat(saqueAmount.value);
                        const newBalance = userData.balance - saqueValue;

                        if (newBalance >= 0) {
                            updateDoc(doc(db, 'users', user.uid), { balance: newBalance }).then(() => {
                                addDoc(collection(db, 'saquepix'), {
                                    nome: userData.name,
                                    cpf: userData.cpf,
                                    pix: userData.pix,
                                    pix_saque_solicitado: saqueValue,
                                    saldo_anterior: userData.balance,
                                    saldo_atualizado: newBalance
                                }).then(() => {
                                    saqueBalance.innerText = newBalance;
                                    alert('Saque realizado com sucesso!');
                                    saqueModal.style.display = 'none';
                                });
                            });
                        } else {
                            alert('Saldo insuficiente.');
                        }
                    }
                });
            }
        });

    </script>
</body>
</html>
